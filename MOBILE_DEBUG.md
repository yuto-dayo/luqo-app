# スマホからローカル開発サーバーに接続する方法

このドキュメントでは、スマートフォンからローカル開発サーバーに接続してデバッグする方法を説明します。

## 前提条件

- PCとスマホが**同じWi-Fiネットワーク**に接続されていること
- フロントエンドとバックエンドのサーバーが起動していること

## 手順

### 1. ローカルIPアドレスを確認

プロジェクトルートで以下のコマンドを実行して、PCのローカルIPアドレスを確認します：

```bash
npm run show-ip
```

または、手動で確認する場合：

**macOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```cmd
ipconfig
```
（`IPv4 アドレス` の項目を確認）

### 2. サーバー接続をテスト

サーバーを起動する前に、接続テストを実行してサーバーが正しく動作しているか確認できます：

```bash
npm run test-server
```

このコマンドは、localhostとローカルIPの両方からサーバーに接続できるかテストします。

### 3. サーバーを起動

**バックエンドサーバー:**
```bash
cd server
npm run dev
```

サーバーが起動すると、以下のようなメッセージが表示されます：
```
LUQO server listening on http://0.0.0.0:4000
Access from other devices: http://[YOUR_LOCAL_IP]:4000
```

**フロントエンドサーバー:**
```bash
cd frontend
npm run dev
```

両方のサーバーは `0.0.0.0` で起動するため、外部からアクセス可能です。

### 4. スマホからアクセス

スマホのブラウザで以下のURLを開きます：

```
http://[PCのローカルIP]:5173
```

例: `http://192.168.1.100:5173`

### 5. API接続について

フロントエンドの `config.ts` が自動的にAPIのURLを決定します：

- **PCからアクセス時**: `http://localhost:4000`
- **スマホからアクセス時**: `http://[PCのローカルIP]:4000`

環境変数 `VITE_API_BASE_URL` が設定されている場合は、その値が優先されます。

## トラブルシューティング

### データが取得できない場合

スマホから接続できてもデータが取得できない場合は、以下を確認してください：

1. **ブラウザのコンソールを確認**
   - スマホのブラウザで開発者ツールを開く（Chrome: `chrome://inspect`）
   - コンソールに表示されるエラーメッセージを確認
   - `[API Request]` や `[Config]` のログで、実際に使用されているURLを確認

2. **サーバーのログを確認**
   - バックエンドサーバーのターミナルで、リクエストログを確認
   - `[YYYY-MM-DD] GET /api/v1/...` のようなログが表示されているか確認
   - CORSエラーや認証エラーがないか確認

3. **APIのURLが正しいか確認**
   - ブラウザのコンソールで `[Config] API Base URL:` のログを確認
   - スマホからアクセスしている場合、`http://[PCのローカルIP]:4000` になっているはず
   - もし `http://localhost:4000` になっている場合は、`config.ts` の自動検出が動作していない可能性があります

4. **接続テストを実行**
   ```bash
   npm run test-server
   ```
   - すべてのテストが成功することを確認
   - 失敗する場合は、サーバーが正しく起動していない可能性があります

### 接続できない場合

1. **ファイアウォールの確認**
   - macOS: システム環境設定 > セキュリティとプライバシー > ファイアウォール
   - Windows: Windows Defender ファイアウォールの設定を確認
   - ポート 4000 と 5173 が許可されているか確認

2. **同じWi-Fiネットワークに接続されているか確認**
   - PCとスマホが同じルーターに接続されている必要があります
   - モバイルデータではなく、Wi-Fiを使用していることを確認

3. **ポートが使用可能か確認**
   - フロントエンド: ポート 5173
   - バックエンド: ポート 4000
   - 他のアプリケーションがこれらのポートを使用していないか確認

4. **サーバーのログを確認**
   - サーバーが正常に起動しているか、エラーメッセージがないか確認
   - `0.0.0.0` でリッスンしていることを確認

### HMR（ホットリロード）について

スマホから接続した場合、HMR（ホットリロード）は動作しない可能性があります。
コードを変更した場合は、スマホのブラウザを手動でリロードしてください。

## 注意事項

- 開発環境でのみ使用してください
- 本番環境では適切なセキュリティ設定を行ってください
- ローカルネットワーク内でのみアクセス可能です
